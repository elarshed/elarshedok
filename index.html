<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أداة دراسة جدوى المتجر الإلكتروني</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <!-- Google Fonts (Cairo) -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #dbe2ef, #c0c8e0);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    .container {
      max-width: 2100px;
      margin: 0 auto;
      padding: 5.5rem;
    }
    .section {
      background: white;
      border-radius: 2.75rem;
      box-shadow: 0 18px 55px rgba(0,0,0,0.15);
      padding: 5.5rem;
      margin-bottom: 5.5rem;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    .section:hover {
      transform: translateY(-22px);
      box-shadow: 0 22px 60px rgba(0,0,0,0.25);
    }
    .tab {
      padding: 2.5rem 5rem;
      border-bottom: 10px solid transparent;
      cursor: pointer;
      font-weight: 700;
      color: #4b5563;
      transition: all 0.3s ease;
      border-radius: 2.25rem 2.25rem 0 0;
      background: #f1f5f9;
    }
    .tab.active {
      border-color: #1e40af;
      color: #1e40af;
      background: #dbeafe;
    }
    .tab:hover {
      color: #1e40af;
      background: #eff6ff;
    }
    .input-group {
      position: relative;
      margin-bottom: 5rem;
    }
    .input {
      width: 100%;
      padding: 1.6rem 6rem 1.6rem 1.6rem;
      border: 1px solid #d1d5db;
      border-radius: 2rem;
      transition: all 0.3s ease;
      background: #f9fafb;
      font-size: 1.3rem;
    }
    .input:focus {
      border-color: #1e40af;
      box-shadow: 0 0 22px rgba(30, 64, 175, 0.5);
      outline: none;
      background: white;
    }
    .input-icon {
      position: absolute;
      right: 2.5rem;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
    }
    .input-desc {
      font-size: 1.2rem;
      color: #6b7280;
      margin-top: 1.5rem;
      line-height: 1.9;
    }
    .btn {
      padding: 1.6rem 5rem;
      border-radius: 2rem;
      font-weight: 700;
      transition: all 0.4s ease;
      display: flex;
      align-items: center;
      gap: 2rem;
      box-shadow: 0 12px 35px rgba(0,0,0,0.2);
    }
    .btn:hover {
      transform: translateY(-12px);
      box-shadow: 0 20px 45px rgba(0,0,0,0.3);
    }
    .dashboard-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border-radius: 2.5rem;
      padding: 5rem;
      text-align: center;
      box-shadow: 0 16px 45px rgba(0,0,0,0.2);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.9);
    }
    .dashboard-card:hover {
      transform: scale(1.18) rotate(5deg);
      box-shadow: 0 22px 55px rgba(0,0,0,0.3);
    }
    .dashboard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 16px;
      background: linear-gradient(to right, #1e40af, #60a5fa, #93c5fd);
      animation: gradientShift 2s infinite linear;
    }
    .dashboard-card::after {
      content: '';
      position: absolute;
      top: -90%;
      left: -90%;
      width: 280%;
      height: 280%;
      background: radial-gradient(circle, rgba(30,64,175,0.3) 0%, rgba(255,255,255,0) 70%);
      animation: pulse 3.5s infinite ease-in-out;
    }
    .dashboard-desc {
      font-size: 1.2rem;
      color: #6b7280;
      margin-top: 2rem;
      line-height: 1.9;
    }
    .chart-container {
      position: relative;
      height: 750px;
      width: 100%;
      background: white;
      border-radius: 2.75rem;
      padding: 5rem;
      box-shadow: 0 18px 50px rgba(0,0,0,0.15);
    }
    .profile-card {
      background: linear-gradient(135deg, #1e40af, #1e3a8a);
      color: white;
      padding: 5.5rem;
      border-radius: 2.75rem;
      display: flex;
      align-items: center;
      gap: 5rem;
      box-shadow: 0 18px 55px rgba(0,0,0,0.25);
      position: relative;
      overflow: hidden;
    }
    .profile-card::after {
      content: '';
      position: absolute;
      bottom: -110%;
      left: -55%;
      width: 210%;
      height: 210%;
      background: rgba(255,255,255,0.4);
      transform: skewY(-15deg);
      z-index: 0;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4.5rem;
      background: #f9fafb;
      border-radius: 2.25rem;
      overflow: hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,0.15);
    }
    .table th, .table td {
      border: 1px solid #e5e7eb;
      padding: 3.5rem;
      text-align: center;
    }
    .table th {
      background: #e5e7eb;
      font-weight: 700;
      color: #1f2937;
    }
    .table tbody tr:nth-child(even) {
      background: #f1f5f9;
    }
    .table tbody tr:hover {
      background: #dbeafe;
      transition: background 0.2s ease;
    }
    .alert {
      padding: 3.5rem;
      border-radius: 2rem;
      margin-bottom: 4.5rem;
      animation: fadeIn 1s ease-in-out;
      display: flex;
      align-items: center;
      gap: 3rem;
      box-shadow: 0 14px 40px rgba(0,0,0,0.18);
    }
    .alert-error {
      background-color: #fee2e2;
      color: #991b1b;
    }
    .alert-success {
      background-color: #d1fae5;
      color: #065f46;
    }
    .alert-info {
      background-color: #dbeafe;
      color: #1e40af;
    }
    .currency-select {
      padding: 1.6rem;
      border: 1px solid #d1d5db;
      border-radius: 2rem;
      background: white;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    .currency-select:focus {
      border-color: #1e40af;
      box-shadow: 0 0 14px rgba(30, 64, 175, 0.5);
      outline: none;
    }
    .negative {
      color: #ef4444;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-45px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.6); opacity: 0.6; }
      100% { transform: scale(1); opacity: 0.9; }
    }
    @media (max-width: 768px) {
      .container { padding: 4.5rem; }
      .section { padding: 5rem; }
      .tab { padding: 2.25rem 4.5rem; }
      .dashboard-card { padding: 4.5rem; }
      .profile-card { flex-direction: column; text-align: center; gap: 4.5rem; }
    }
    @media print {
      .no-print { display: none; }
      body { background: white; }
      .section { box-shadow: none; }
      .dashboard-card { box-shadow: none; border: 1px solid #e5e7eb; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Profile Card -->
    <div class="profile-card mb-20 no-print">
      <img src="https://via.placeholder.com/100" alt="أحمد محمد" class="rounded-full w-52 h-52 object-cover border-4 border-white relative z-10" />
      <div class="relative z-10">
        <h1 class="text-8xl font-bold">أحمد محمد عبد السلام</h1>
        <p class="text-6xl opacity-90">خبير التجارة الإلكترونية</p>
      </div>
      <div class="ml-auto flex items-center gap-18 relative z-10">
        <label class="text-white font-semibold text-6xl">العملة:</label>
        <select id="currency" class="currency-select">
          <option value="ج.م">ج.م</option>
          <option value="$">دولار</option>
          <option value="€">يورو</option>
          <option value="ر.س">ريال سعودي</option>
        </select>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex flex-wrap gap-14 mb-20 border-b border-gray-200 no-print">
      <span class="tab active" data-tab="products">المنتجات</span>
      <span class="tab" data-tab="orders">الطلب</span>
      <span class="tab" data-tab="pricing">التسعير</span>
      <span class="tab" data-tab="dashboard">لوحة المعلومات</span>
    </div>

    <!-- Products Section -->
    <div id="products" class="section tab-content active">
      <h2 class="text-8xl font-bold mb-20 flex items-center gap-14">
        <i class="fas fa-box"></i> المنتجات
      </h2>
      <div id="productList" class="space-y-18"></div>
      <button id="addProduct" class="btn bg-blue-600 text-white hover:bg-blue-700 mt-18 no-print">
        <i class="fas fa-plus"></i> إضافة منتج
      </button>
    </div>

    <!-- Orders Section -->
    <div id="orders" class="section tab-content hidden">
      <h2 class="text-8xl font-bold mb-20 flex items-center gap-14">
        <i class="fas fa-shopping-cart"></i> الطلب
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-20">
        <div class="input-group">
          <label class="block mb-2 font-semibold">نسبة التسليم الافتراضية (%)</label>
          <input id="defaultDeliveryRate" type="number" class="input" value="0" min="0" max="100" />
          <i class="fas fa-percentage input-icon"></i>
          <p class="input-desc">نسبة التسليم العامة إذا لم تُحدد للمنتج (مثل: 85%).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة الإعلان لكل طلب</label>
          <input id="adCostPerOrder" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-ad input-icon"></i>
          <p class="input-desc">متوسط تكلفة جذب طلب واحد (مثل: 15 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة المرتجع لكل طلب</label>
          <input id="returnCostPerOrder" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-undo input-icon"></i>
          <p class="input-desc">تكلفة معالجة الطلب المرتجع (مثل: 20 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">رواتب الموظفين الشهرية</label>
          <input id="staffCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-users input-icon"></i>
          <p class="input-desc">إجمالي رواتب الفريق شهريًا (مثل: 5000 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة تشغيل الموقع</label>
          <input id="websiteCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-globe input-icon"></i>
          <p class="input-desc">تكاليف استضافة الموقع (مثل: 200 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة التغليف لكل طلب</label>
          <input id="packagingCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-box-open input-icon"></i>
          <p class="input-desc">تكلفة مواد التغليف لكل طلب (مثل: 5 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة التخزين الشهرية</label>
          <input id="storageCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-warehouse input-icon"></i>
          <p class="input-desc">تكلفة تخزين المنتجات شهريًا (مثل: 1000 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة التسويق غير المدفوع</label>
          <input id="organicMarketingCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-bullhorn input-icon"></i>
          <p class="input-desc">تكلفة التسويق العضوي شهريًا (مثل: 500 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة دعم العملاء</label>
          <input id="supportCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-headset input-icon"></i>
          <p class="input-desc">تكلفة خدمة العملاء شهريًا (مثل: 300 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة الصيانة الشهرية</label>
          <input id="maintenanceCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-tools input-icon"></i>
          <p class="input-desc">تكلفة صيانة الموقع أو المعدات (مثل: 400 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة التدريب الشهرية</label>
          <input id="trainingCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-chalkboard-teacher input-icon"></i>
          <p class="input-desc">تكلفة تدريب الموظفين شهريًا (مثل: 200 ج.م).</p>
        </div>
      </div>
    </div>

    <!-- Pricing Section -->
    <div id="pricing" class="section tab-content hidden">
      <h2 class="text-8xl font-bold mb-20 flex items-center gap-14">
        <i class="fas fa-dollar-sign"></i> التسعير
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-20">
        <div class="input-group">
          <label class="block mb-2 font-semibold">الربح الافتراضي لكل طلب</label>
          <input id="defaultDesiredProfit" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-coins input-icon"></i>
          <p class="input-desc">الربح الصافي الافتراضي لتغطية التكاليف بدون مكسب أو خسارة (يمكنك زيادته).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">نسبة الخصم (%)</label>
          <input id="discountRate" type="number" class="input" value="0" min="0" max="100" />
          <i class="fas fa-tags input-icon"></i>
          <p class="input-desc">نسبة الخصم للعملاء (مثل: 10%).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">تكلفة الدفع عند الاستلام</label>
          <input id="codCost" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-money-bill input-icon"></i>
          <p class="input-desc">رسوم الدفع عند الاستلام (مثل: 10 ج.م).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">نسبة الضرائب (%)</label>
          <input id="taxRate" type="number" class="input" value="0" min="0" max="100" />
          <i class="fas fa-calculator input-icon"></i>
          <p class="input-desc">نسبة الضرائب على الطلب (مثل: 14%).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">رسوم بوابة الدفع (%)</label>
          <input id="paymentGatewayFee" type="number" class="input" value="0" min="0" max="100" />
          <i class="fas fa-credit-card input-icon"></i>
          <p class="input-desc">نسبة رسوم الدفع الإلكتروني (مثل: 2.5%).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">نسبة العمولة للمنصة (%)</label>
          <input id="platformCommission" type="number" class="input" value="0" min="0" max="100" />
          <i class="fas fa-store input-icon"></i>
          <p class="input-desc">نسبة العمولة لمنصة البيع (مثل: 5%).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">الهدف من ROAS</label>
          <input id="targetROAS" type="number" class="input" value="0" min="0" step="0.01" />
          <i class="fas fa-bullseye input-icon"></i>
          <p class="input-desc">العائد المستهدف على الإنفاق الإعلاني (مثل: 3).</p>
        </div>
        <div class="input-group">
          <label class="block mb-2 font-semibold">نسبة العملاء المتكررين (%)</label>
          <input id="repeatCustomerRate" type="number" class="input" value="0" min="0" max="100" />
          <i class="fas fa-users input-icon"></i>
          <p class="input-desc">نسبة العملاء الذين يعودون للشراء (مثل: 20%).</p>
        </div>
      </div>
      <div class="mt-20">
        <h3 class="text-7xl font-semibold mb-18 flex items-center gap-14">
          <i class="fas fa-table"></i> أسعار البيع المقترحة
        </h3>
        <table class="table" id="pricingTable">
          <thead><tr><th>المنتج</th><th>التكلفة الإجمالية</th><th>السعر قبل الخصم</th><th>السعر بعد الخصم</th><th>الضرائب</th><th>رسوم البوابة</th><th>عمولة المنصة</th><th>الربح لكل طلب</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard" class="section tab-content hidden">
      <h2 class="text-8xl font-bold mb-22 flex items-center gap-14">
        <i class="fas fa-tachometer-alt"></i> لوحة المعلومات
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-20 mb-22">
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي المبيعات</p>
          <p id="dashRevenue" class="text-9xl font-bold text-blue-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي الإيرادات بعد الخصم والضرائب.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">صافي الربح</p>
          <p id="dashNetProfit" class="text-9xl font-bold">ج.م 0</p>
          <p class="dashboard-desc">الربح بعد خصم كل التكاليف.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">نقطة التعادل</p>
          <p id="dashBreakEven" class="text-9xl font-bold text-yellow-600">0 طلب</p>
          <p class="dashboard-desc">عدد الطلبات لتغطية التكاليف.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">ROAS</p>
          <p id="dashROAS" class="text-9xl font-bold text-purple-600">0</p>
          <p class="dashboard-desc">العائد على الإنفاق الإعلاني.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">متوسط تكلفة الطلب</p>
          <p id="dashAvgOrderCost" class="text-9xl font-bold text-teal-600">ج.م 0</p>
          <p class="dashboard-desc">متوسط التكلفة لكل طلب.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">نسبة المرتجعات (%)</p>
          <p id="dashReturnRate" class="text-9xl font-bold text-red-600">0%</p>
          <p class="dashboard-desc">نسبة الطلبات المرتجعة.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي الضرائب</p>
          <p id="dashTotalTax" class="text-9xl font-bold text-orange-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي الضرائب على المبيعات.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">هامش الربح (%)</p>
          <p id="dashProfitMargin" class="text-9xl font-bold text-green-600">0%</p>
          <p class="dashboard-desc">نسبة الربح من المبيعات.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي رسوم البوابة</p>
          <p id="dashGatewayFees" class="text-9xl font-bold text-pink-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي رسوم الدفع الإلكتروني.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي تكلفة التخزين</p>
          <p id="dashStorageCost" class="text-9xl font-bold text-indigo-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي تكاليف التخزين الشهرية.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي تكلفة التسويق العضوي</p>
          <p id="dashOrganicMarketingCost" class="text-9xl font-bold text-cyan-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي تكاليف التسويق غير المدفوع.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي عمولة المنصة</p>
          <p id="dashPlatformCommission" class="text-9xl font-bold text-amber-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي عمولة منصة البيع.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي تكلفة دعم العملاء</p>
          <p id="dashSupportCost" class="text-9xl font-bold text-gray-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي تكاليف خدمة العملاء.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي تكلفة الصيانة</p>
          <p id="dashMaintenanceCost" class="text-9xl font-bold text-blue-800">ج.م 0</p>
          <p class="dashboard-desc">إجمالي تكاليف الصيانة الشهرية.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">المبلغ المطلوب للإعلانات</p>
          <p id="dashRequiredAdSpend" class="text-9xl font-bold text-violet-600">ج.م 0</p>
          <p class="dashboard-desc">الإنفاق الإعلاني لتحقيق هدف ROAS.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إجمالي تكلفة التدريب</p>
          <p id="dashTrainingCost" class="text-9xl font-bold text-lime-600">ج.م 0</p>
          <p class="dashboard-desc">إجمالي تكاليف تدريب الموظفين.</p>
        </div>
        <div class="dashboard-card">
          <p class="text-gray-600 font-semibold text-4xl">إيرادات العملاء المتكررين</p>
          <p id="dashRepeatRevenue" class="text-9xl font-bold text-emerald-600">ج.م 0</p>
          <p class="dashboard-desc">الإيرادات من العملاء المتكررين.</p>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="costBreakdownChart"></canvas>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap gap-18 mt-20 no-print">
      <button id="calculate" class="btn bg-green-600 text-white hover:bg-green-700">
        <i class="fas fa-calculator"></i> حساب النتائج
      </button>
      <button id="reset" class="btn bg-red-600 text-white hover:bg-red-700">
        <i class="fas fa-undo"></i> إعادة تعيين
      </button>
      <button id="print" class="btn bg-gray-600 text-white hover:bg-gray-700">
        <i class="fas fa-print"></i> طباعة
      </button>
    </div>
  </div>

  <script>
    // البيانات العالمية
    let products = [{ name: "منتج 1", buyPrice: 0, shipping: 0, otherCosts: 0, expectedDeliveries: 0, desiredProfit: 0 }];
    let currency = document.getElementById("currency").value;
    let costChart = null;

    // تبديل التبويبات
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.tab).classList.remove("hidden");
      });
    });

    // عرض المنتجات
    function renderProducts() {
      const productList = document.getElementById("productList");
      productList.innerHTML = "";
      products.forEach((product, index) => {
        const div = document.createElement("div");
        div.className = "border rounded-lg p-18 bg-gray-50 shadow-sm transition-all duration-300 hover:bg-gray-100";
        div.innerHTML = `
          <div class="flex justify-between items-center mb-18">
            <div class="input-group w-1/4">
              <input type="text" value="${product.name}" class="input" data-index="${index}" data-field="name" placeholder="اسم المنتج" />
              <i class="fas fa-tag input-icon"></i>
              <p class="input-desc">اسم المنتج أو نوعه (مثل: تيشيرت، حذاء).</p>
            </div>
            <button class="text-red-600 hover:text-red-800 no-print" data-index="${index}">
              <i class="fas fa-trash"></i> حذف
            </button>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-5 gap-18">
            <div class="input-group">
              <label class="block mb-2 font-semibold">سعر الشراء</label>
              <input type="number" value="${product.buyPrice}" class="input" data-index="${index}" data-field="buyPrice" min="0" step="0.01" />
              <i class="fas fa-shopping-cart input-icon"></i>
              <p class="input-desc">تكلفة شراء المنتج (مثل: 50 ج.م).</p>
            </div>
            <div class="input-group">
              <label class="block mb-2 font-semibold">تكلفة الشحن</label>
              <input type="number" value="${product.shipping}" class="input" data-index="${index}" data-field="shipping" min="0" step="0.01" />
              <i class="fas fa-truck input-icon"></i>
              <p class="input-desc">تكلفة شحن المنتج (مثل: 20 ج.م).</p>
            </div>
            <div class="input-group">
              <label class="block mb-2 font-semibold">تكاليف أخرى</label>
              <input type="number" value="${product.otherCosts}" class="input" data-index="${index}" data-field="otherCosts" min="0" step="0.01" />
              <i class="fas fa-tools input-icon"></i>
              <p class="input-desc">مصروفات إضافية (مثل: 10 ج.م).</p>
            </div>
            <div class="input-group">
              <label class="block mb-2 font-semibold">التسليمات المتوقعة</label>
              <input type="number" value="${product.expectedDeliveries}" class="input" data-index="${index}" data-field="expectedDeliveries" min="0" />
              <i class="fas fa-shopping-bag input-icon"></i>
              <p class="input-desc">عدد التسليمات الشهرية (مثل: 50 طلب).</p>
            </div>
            <div class="input-group">
              <label class="block mb-2 font-semibold">الربح المطلوب</label>
              <input type="number" value="${product.desiredProfit}" class="input" data-index="${index}" data-field="desiredProfit" min="0" step="0.01" />
              <i class="fas fa-coins input-icon"></i>
              <p class="input-desc">الربح الصافي لكل طلب (مثل: 30 ج.م).</p>
            </div>
          </div>
        `;
        productList.appendChild(div);
      });

      productList.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", (e) => {
          const index = e.target.dataset.index;
          const field = e.target.dataset.field;
          products[index][field] = field === "name" ? e.target.value : Math.max(parseFloat(e.target.value) || 0, 0);
          calculateAll();
        });
      });

      productList.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          if (products.length > 1) {
            products.splice(btn.dataset.index, 1);
            renderProducts();
            calculateAll();
            showAlert("تم حذف المنتج بنجاح!", "success");
          } else {
            showAlert("لا يمكن حذف المنتج الوحيد!", "error");
          }
        });
      });
    }

    // إضافة منتج
    document.getElementById("addProduct").addEventListener("click", () => {
      products.push({ name: `منتج ${products.length + 1}`, buyPrice: 0, shipping: 0, otherCosts: 0, expectedDeliveries: 0, desiredProfit: 0 });
      renderProducts();
      calculateAll();
      showAlert("تم إضافة منتج جديد!", "success");
    });

    // الحسابات الأساسية
    function calculateAll() {
      if (products.length === 0) {
        showAlert("يرجى إضافة منتج واحد على الأقل!", "error");
        return;
      }

      currency = document.getElementById("currency").value;

      // تكاليف المنتجات
      const productCosts = products.map(p => ({
        name: p.name,
        totalCost: Math.max(p.buyPrice + p.shipping + p.otherCosts, 0),
        expectedDeliveries: Math.max(p.expectedDeliveries, 0),
        desiredProfit: Math.max(p.desiredProfit, 0)
      }));

      const defaultDeliveryRate = Math.min(Math.max(parseFloat(document.getElementById("defaultDeliveryRate").value) || 0, 0), 100);
      const adCostPerOrder = Math.max(parseFloat(document.getElementById("adCostPerOrder").value) || 0, 0);
      const returnCostPerOrder = Math.max(parseFloat(document.getElementById("returnCostPerOrder").value) || 0, 0);
      const staffCost = Math.max(parseFloat(document.getElementById("staffCost").value) || 0, 0);
      const websiteCost = Math.max(parseFloat(document.getElementById("websiteCost").value) || 0, 0);
      const packagingCost = Math.max(parseFloat(document.getElementById("packagingCost").value) || 0, 0);
      const storageCost = Math.max(parseFloat(document.getElementById("storageCost").value) || 0, 0);
      const organicMarketingCost = Math.max(parseFloat(document.getElementById("organicMarketingCost").value) || 0, 0);
      const supportCost = Math.max(parseFloat(document.getElementById("supportCost").value) || 0, 0);
      const maintenanceCost = Math.max(parseFloat(document.getElementById("maintenanceCost").value) || 0, 0);
      const trainingCost = Math.max(parseFloat(document.getElementById("trainingCost").value) || 0, 0);

      const discountRate = Math.min(Math.max(parseFloat(document.getElementById("discountRate").value) || 0, 0), 100);
      const codCost = Math.max(parseFloat(document.getElementById("codCost").value) || 0, 0);
      const taxRate = Math.min(Math.max(parseFloat(document.getElementById("taxRate").value) || 0, 0), 100);
      const paymentGatewayFee = Math.min(Math.max(parseFloat(document.getElementById("paymentGatewayFee").value) || 0, 0), 100);
      const platformCommission = Math.min(Math.max(parseFloat(document.getElementById("platformCommission").value) || 0, 0), 100);
      const targetROAS = Math.max(parseFloat(document.getElementById("targetROAS").value) || 0, 0);
      const repeatCustomerRate = Math.min(Math.max(parseFloat(document.getElementById("repeatCustomerRate").value) || 0, 0), 100);

      // الطلبات
      const totalExpectedOrders = productCosts.reduce((sum, p) => sum + p.expectedDeliveries, 0);
      const deliveredOrders = productCosts.map(p => p.expectedDeliveries * (defaultDeliveryRate / 100));
      const returnedOrders = productCosts.map(p => p.expectedDeliveries * ((100 - defaultDeliveryRate) / 100));
      const totalDeliveredOrders = deliveredOrders.reduce((sum, d) => sum + d, 0);

      // حساب التكاليف الكلية بدون الربح
      const totalProductCost = productCosts.reduce((sum, p, i) => sum + p.totalCost * deliveredOrders[i], 0);
      const totalAdCost = totalExpectedOrders * adCostPerOrder;
      const totalReturnCost = returnedOrders.reduce((sum, r) => sum + r, 0) * returnCostPerOrder;
      const totalCodCost = totalDeliveredOrders * codCost;
      const totalPackagingCost = totalDeliveredOrders * packagingCost;
      const fixedCosts = staffCost + websiteCost + storageCost + organicMarketingCost + supportCost + maintenanceCost + trainingCost;

      const totalVariableCost = totalProductCost + totalAdCost + totalReturnCost + totalCodCost + totalPackagingCost;
      const totalCostBeforeProfit = totalVariableCost + fixedCosts;

      // حساب الربح الافتراضي لتغطية التكاليف (صافي الربح = 0)
      let defaultDesiredProfit = 0;
      if (totalDeliveredOrders > 0) {
        const baseCostPerOrder = totalCostBeforeProfit / totalDeliveredOrders;
        const taxMultiplier = taxRate / 100;
        const gatewayMultiplier = paymentGatewayFee / 100;
        const platformMultiplier = platformCommission / 100;
        const discountMultiplier = discountRate / 100;
        
        const revenuePerOrderBeforeProfit = baseCostPerOrder / (1 - taxMultiplier - gatewayMultiplier - platformMultiplier - discountMultiplier);
        defaultDesiredProfit = revenuePerOrderBeforeProfit - (productCosts[0].totalCost + packagingCost + codCost); // افتراضي لكل طلب
      }

      // إذا لم يُحدد الربح للمنتجات، استخدم القيمة المقترحة
      const suggestedPrices = productCosts.map(p => {
        const desiredProfit = p.desiredProfit > 0 ? p.desiredProfit : defaultDesiredProfit;
        const baseCost = p.totalCost + packagingCost;
        const priceBeforeDiscount = baseCost + desiredProfit + codCost;
        const discountAmount = priceBeforeDiscount * (discountRate / 100);
        const priceAfterDiscount = priceBeforeDiscount - discountAmount;
        const taxAmount = priceAfterDiscount * (taxRate / 100);
        const gatewayFee = priceAfterDiscount * (paymentGatewayFee / 100);
        const platformFee = priceAfterDiscount * (platformCommission / 100);
        const finalPrice = priceAfterDiscount + taxAmount + gatewayFee + platformFee;
        return {
          name: p.name,
          totalCost: baseCost,
          priceBeforeDiscount,
          priceAfterDiscount,
          taxAmount,
          gatewayFee,
          platformFee,
          profitPerOrder: priceAfterDiscount - baseCost - codCost - gatewayFee - platformFee,
          expectedDeliveries: p.expectedDeliveries
        };
      });

      // الحسابات المالية
      const totalRevenue = suggestedPrices.reduce((sum, p, i) => sum + p.priceAfterDiscount * deliveredOrders[i], 0);
      const totalTax = suggestedPrices.reduce((sum, p, i) => sum + p.taxAmount * deliveredOrders[i], 0);
      const totalGatewayFees = suggestedPrices.reduce((sum, p, i) => sum + p.gatewayFee * deliveredOrders[i], 0);
      const totalPlatformCommission = suggestedPrices.reduce((sum, p, i) => sum + p.platformFee * deliveredOrders[i], 0);
      const totalExpenses = totalCostBeforeProfit + totalTax + totalGatewayFees + totalPlatformCommission;
      const netProfit = totalRevenue - totalExpenses;
      const requiredAdSpend = targetROAS > 0 ? totalRevenue / targetROAS : 0;

      // إيرادات العملاء المتكررين
      const repeatRevenue = totalRevenue * (repeatCustomerRate / 100);

      // تحديث الربح الافتراضي في واجهة المستخدم
      const defaultProfitInput = document.getElementById("defaultDesiredProfit");
      if (defaultProfitInput.value == 0 || !defaultProfitInput.dataset.userModified) {
        defaultProfitInput.value = defaultDesiredProfit.toFixed(2);
        defaultProfitInput.dataset.userModified = false;
      }

      // تنبيه المستخدم
      if (!defaultProfitInput.dataset.userModified) {
        showAlert(`الربح الافتراضي (${currency} ${defaultDesiredProfit.toFixed(2)}) يغطي التكاليف بدون مكسب أو خسارة. يمكنك زيادته لتحقيق ربح إضافي!`, "info");
      }

      // مخرجات إضافية
      const avgOrderCost = totalExpectedOrders > 0 ? totalExpenses / totalExpectedOrders : 0;
      const returnRatePercentage = totalExpectedOrders > 0 ? (returnedOrders.reduce((sum, r) => sum + r, 0) / totalExpectedOrders) * 100 : 0;
      const profitMargin = totalRevenue > 0 ? (netProfit / totalRevenue) * 100 : 0;

      // تحديث لوحة المعلومات
      const dashNetProfit = document.getElementById("dashNetProfit");
      document.getElementById("dashRevenue").textContent = `${currency} ${totalRevenue.toFixed(2)}`;
      dashNetProfit.textContent = `${currency} ${netProfit.toFixed(2)}`;
      dashNetProfit.classList.toggle("negative", netProfit < 0);
      const totalDesiredProfit = suggestedPrices.reduce((sum, p, i) => sum + p.profitPerOrder * deliveredOrders[i], 0);
      const breakEven = totalDesiredProfit > 0 ? Math.ceil((totalExpenses - totalRevenue + fixedCosts) / (totalDesiredProfit / totalDeliveredOrders)) : 0;
      document.getElementById("dashBreakEven").textContent = `${breakEven} طلب`;
      const roas = totalAdCost > 0 ? totalRevenue / totalAdCost : 0;
      document.getElementById("dashROAS").textContent = roas.toFixed(2);
      document.getElementById("dashAvgOrderCost").textContent = `${currency} ${avgOrderCost.toFixed(2)}`;
      document.getElementById("dashReturnRate").textContent = `${returnRatePercentage.toFixed(2)}%`;
      document.getElementById("dashTotalTax").textContent = `${currency} ${totalTax.toFixed(2)}`;
      document.getElementById("dashProfitMargin").textContent = `${profitMargin.toFixed(2)}%`;
      document.getElementById("dashGatewayFees").textContent = `${currency} ${totalGatewayFees.toFixed(2)}`;
      document.getElementById("dashStorageCost").textContent = `${currency} ${storageCost.toFixed(2)}`;
      document.getElementById("dashOrganicMarketingCost").textContent = `${currency} ${organicMarketingCost.toFixed(2)}`;
      document.getElementById("dashPlatformCommission").textContent = `${currency} ${totalPlatformCommission.toFixed(2)}`;
      document.getElementById("dashSupportCost").textContent = `${currency} ${supportCost.toFixed(2)}`;
      document.getElementById("dashMaintenanceCost").textContent = `${currency} ${maintenanceCost.toFixed(2)}`;
      document.getElementById("dashRequiredAdSpend").textContent = `${currency} ${requiredAdSpend.toFixed(2)}`;
      document.getElementById("dashTrainingCost").textContent = `${currency} ${trainingCost.toFixed(2)}`;
      document.getElementById("dashRepeatRevenue").textContent = `${currency} ${repeatRevenue.toFixed(2)}`;

      // تحديث جدول التسعير
      const pricingTable = document.querySelector("#pricingTable tbody");
      pricingTable.innerHTML = "";
      suggestedPrices.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${p.name}</td>
          <td>${p.totalCost.toFixed(2)}</td>
          <td>${p.priceBeforeDiscount.toFixed(2)}</td>
          <td>${p.priceAfterDiscount.toFixed(2)}</td>
          <td>${p.taxAmount.toFixed(2)}</td>
          <td>${p.gatewayFee.toFixed(2)}</td>
          <td>${p.platformFee.toFixed(2)}</td>
          <td>${p.profitPerOrder.toFixed(2)}</td>
        `;
        pricingTable.appendChild(row);
      });

      // تحديث المخطط
      updateChart(totalProductCost, totalAdCost, totalReturnCost, staffCost, websiteCost, totalCodCost, totalPackagingCost, totalTax, totalGatewayFees, storageCost, organicMarketingCost, supportCost, maintenanceCost, trainingCost, totalPlatformCommission);
    }

    // تحديث المخطط
    function updateChart(productCost, adCost, returnCost, staffCost, websiteCost, codCost, packagingCost, taxCost, gatewayFees, storageCost, organicMarketingCost, supportCost, maintenanceCost, trainingCost, platformCommission) {
      if (costChart) costChart.destroy();
      costChart = new Chart(document.getElementById("costBreakdownChart").getContext("2d"), {
        type: "pie",
        data: {
          labels: ["تكلفة المنتجات", "الإعلانات", "المرتجعات", "الموظفين", "تشغيل الموقع", "الدفع عند الاستلام", "التغليف", "الضرائب", "رسوم البوابة", "التخزين", "التسويق العضوي", "دعم العملاء", "الصيانة", "التدريب", "عمولة المنصة"],
          datasets: [{
            data: [
              Math.max(productCost, 0),
              Math.max(adCost, 0),
              Math.max(returnCost, 0),
              Math.max(staffCost, 0),
              Math.max(websiteCost, 0),
              Math.max(codCost, 0),
              Math.max(packagingCost, 0),
              Math.max(taxCost, 0),
              Math.max(gatewayFees, 0),
              Math.max(storageCost, 0),
              Math.max(organicMarketingCost, 0),
              Math.max(supportCost, 0),
              Math.max(maintenanceCost, 0),
              Math.max(trainingCost, 0),
              Math.max(platformCommission, 0)
            ],
            backgroundColor: ["#3b82f6", "#ef4444", "#f59e0b", "#10b981", "#8b5cf6", "#ec4899", "#14b8a6", "#f97316", "#db2777", "#4f46e5", "#06b6d4", "#6b7280", "#1d4ed8", "#84cc16", "#d97706"],
            borderWidth: 2,
            borderColor: "#fff"
          }]
        },
        options: {
          plugins: {
            legend: { position: "bottom", labels: { font: { size: 24 }, padding: 55 } },
            title: { display: true, text: "تفصيل التكاليف", font: { size: 32 }, padding: 55 },
            tooltip: {
              callbacks: {
                label: (context) => `${context.label}: ${currency} ${context.raw.toFixed(2)}`
              }
            }
          },
          animation: { duration: 4000, easing: "easeOutQuart" }
        }
      });
    }

    // عرض التنبيهات
    function showAlert(message, type) {
      const alertDiv = document.createElement("div");
      alertDiv.className = `alert alert-${type}`;
      alertDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
      document.querySelector(".container").prepend(alertDiv);
      setTimeout(() => alertDiv.remove(), 6500);
    }

    // أحداث المستمعين
    document.querySelectorAll("input").forEach(input => {
      input.addEventListener("input", (e) => {
        if (e.target.id === "defaultDesiredProfit") e.target.dataset.userModified = true;
        debounce(calculateAll, 300)();
      });
    });

    document.getElementById("currency").addEventListener("change", () => {
      currency = document.getElementById("currency").value;
      calculateAll();
    });

    document.getElementById("calculate").addEventListener("click", () => {
      calculateAll();
      showAlert("تم حساب النتائج بنجاح!", "success");
    });

    document.getElementById("reset").addEventListener("click", () => {
      products = [{ name: "منتج 1", buyPrice: 0, shipping: 0, otherCosts: 0, expectedDeliveries: 0, desiredProfit: 0 }];
      document.querySelectorAll("input:not([id='currency'])").forEach(input => {
        input.value = "0";
        if (input.id === "defaultDesiredProfit") input.dataset.userModified = false;
      });
      document.getElementById("currency").value = "ج.م";
      renderProducts();
      calculateAll();
      showAlert("تم إعادة تعيين البيانات!", "success");
    });

    document.getElementById("print").addEventListener("click", () => {
      window.print();
      showAlert("جارٍ الطباعة!", "success");
    });

    // Debounce Function
    function debounce(func, delay) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), delay);
      };
    }

    // التهيئة الأولية
    renderProducts();
    calculateAll();
  </script>
</body>
</html>
